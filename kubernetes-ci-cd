node{
    def pom = readMavenPom file: 'pom.xml'
    def mvnVersion = pom.version
   stage('SCM Checkout'){
        git branch: 'master', 
	        credentialsId: 'rajeshpydi',
	        url: 'https://github.com/javahometech/myweb'
   }
   stage('Maven Build'){
        def mvnHome = tool name: 'maven3', type: 'maven'
		sh "${mvnHome}/bin/mvn clean package"
		sh 'mv target/myweb*.war target/myweb.war'
   }
   stage("Docker build"){
        sh 'docker version'
        sh 'docker build -t jaydan-docker-demo .'
        sh 'docker image list'
        sh 'docker tag jaydan-docker-demo jaydan1/jaydan-docker-demo:jaydan-docker-demo'
    }

    withCredentials([string(credentialsId: 'DOCKER_HUB_PASSWORD', variable: 'PASSWORD')]) {
        sh 'docker login -u jaydan -p $PASSWORD'
    }

    stage("Push Image to Docker Hub"){
        sh 'docker push  jaydan1/jaydan-docker-demo:jaydan-docker-demo'
    }
    
    stage("kubernetes deployment"){
        sh 'kubectl apply -f k8s-spring-boot-deployment.yml'
    }
} 
